#!/usr/bin/env bash
# This script is used to re-encrypt the encrypted files managed by chezmoi.

set -euo pipefail

for encrypted_file in $(chezmoi managed --include encrypted --path-style absolute); do
	# optionally, add --force to avoid prompts
	chezmoi forget --force "$encrypted_file"

	# strip the .asc extension
	decrypted_file="${encrypted_file%.asc}"

	chezmoi add --encrypt "$decrypted_file"
done
